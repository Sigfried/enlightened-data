<!DOCTYPE html><html lang="en"><head><title>index</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="index"><meta name="groc-project-path" content="enlightened-data.js"><meta name="groc-github-url" content="https://github.com/Sigfried/enlightened-data"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/Sigfried/enlightened-data/blob/master/enlightened-data.js">enlightened-data.js</a></div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="enlightened-datajs">enlightened-data.js</h1>

<p>Author: <a href="http://sigfried.org">Sigfried Gold</a> <br />
License: <a href="http://sigfried.mit-license.org/">MIT</a>  </p>

<h3 id="dont-trust-this-documentation-yet-its-just-beginning-to-be-written">Don't trust this documentation yet. It's just beginning to be written.</h3></div></div><div class="code"><div class="wrapper"><span class="s1">&#39;use strict&#39;</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments doc-section doc-section-public"><div class="wrapper"><p><span class='doc-section-header'>Public module enlightenedData</span></p></div></div><div class="code"><div class="wrapper"><span class="kd">var</span> <span class="nx">enlightenedData</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="p">{};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><code>Groups</code> would be a constructor if IE10 supported
__proto__, so it pretends to be one instead.</p></div></div><div class="code"><div class="wrapper">    <span class="kd">function</span> <span class="nx">Groups</span><span class="p">()</span> <span class="p">{}</span>
    <span class="nx">Groups</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">;</span>  <span class="c1">// not sure if this is still necessary</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><h3 id="group-records-by-a-dimension">Group records by a dimension</h3>

<p><em>This works exactly like Underscore's groupBy function (it uses it, in fact)
but returns the resulting object of group values as an array and soups it up
with (almost) everything you could ever want it and its values to do in subsequent
operations.</em></p>

<pre><code>var gradeBook = [
   {firstName: 'Sigfried', lastName: 'Gold', class: 'Remedial Programming', grade: 'C+', num: 2.2},
   {firstName: 'Sigfried', lastName: 'Gold', class: 'Literary Posturing', grade: 'B', num: 3},
   {firstName: 'Sigfried', lastName: 'Gold', class: 'Documenting with Pretty Colors', grade: 'B-', num: 2.7},
   {firstName: 'Someone', lastName: 'Else', class: 'Remedial Programming', grade: 'A'}];

var gradesByLastName = enlightenedData.group(gradeBook, 'lastName')

var gradesByName = enlightenedData.group(gradeBook,  
    function(d) { return d.lastName + ', ' + d.firstName },  
    {dimName: 'fullName'})

var sigfried = gradesByName.lookup('Gold, Sigfried');
sigfried.records.length; // 3
var sigfriedGPA = sigfried.records.reduce(function(result,rec) { return result+rec.num }, 0) / sigfried.records.length;
(it does much much more, will explain below)
</code></pre>

<p>Parameters:</p>

<ul>
<li><p><strong>list must be an Array of Objects.</strong><br/>(representing records to be grouped)</p></li>
<li><p><strong>dim must be a String or Function.</strong><br/>(either the property name to group by or a function returning a group by string)</p></li>
<li><p><strong>opts must be an Object.</strong></p>

<ul><li><p><strong>opts.childProp must be a String and has a default value of 'children'.</strong><br/>(If group ends up being hierarchical, this will be the property name of any children)</p></li>
<li><p><strong>opts.excludeValues is optional and must be an Array of Strings.</strong><br/>(to exlude specific group values)</p></li>
<li><p><strong>opts.preGroupRecsHook is optional and must be a function.</strong><br/>(run list through this function before continuing processing)</p></li>
<li><p><strong>opts.dimName is optional and must be a function.</strong><br/>(defaults to the value of <code>dim</code>. If <code>dim</code> is a function, the dimName will be ugly.)</p></li></ul></li>
</ul>

<p><strong>Returns an Array</strong><br/>(of <code>Value</code>s, the array has all the <code>Groups</code> methods )</p></div></div><div class="code"><div class="wrapper">    <span class="nx">e</span><span class="p">.</span><span class="nx">group</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">dim</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">opts</span> <span class="o">=</span> <span class="nx">opts</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="nx">childProp</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">childProp</span> <span class="o">||</span> <span class="nx">childProp</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">recs</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">preGroupRecsHook</span> <span class="o">?</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">preGroupRecsHook</span><span class="p">(</span><span class="nx">list</span><span class="p">)</span> <span class="o">:</span> <span class="nx">list</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">groupBy</span><span class="p">(</span><span class="nx">recs</span><span class="p">,</span> <span class="nx">dim</span><span class="p">);</span>   <span class="c1">// dim can be a function</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">excludeValues</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">excludeValues</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">delete</span> <span class="nx">g</span><span class="p">[</span><span class="nx">d</span><span class="p">];</span>
            <span class="p">});</span>
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if group values are entirely numeric or null-type values, make the 
result a list of Numbers instead of a list of String</p></div></div><div class="code"><div class="wrapper">        <span class="kd">var</span> <span class="nx">isNumeric</span> <span class="o">=</span> <span class="nx">wholeListNumeric</span><span class="p">(</span><span class="nx">g</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">groups</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">pairs</span><span class="p">(</span><span class="nx">g</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pair</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="kd">var</span> <span class="nx">val</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">isNumeric</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="nx">makeNumberValue</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">val</span> <span class="o">=</span> <span class="nx">makeStringValue</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">val</span><span class="p">.</span><span class="nx">records</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">addGroupMethods</span><span class="p">(</span><span class="nx">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
            <span class="nx">val</span><span class="p">.</span><span class="nx">dim</span> <span class="o">=</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">dimName</span><span class="p">)</span> <span class="o">?</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">dimName</span> <span class="o">:</span> <span class="nx">dim</span><span class="p">;</span>
            <span class="nx">val</span><span class="p">.</span><span class="nx">records</span><span class="p">.</span><span class="nx">parentVal</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span> <span class="c1">// NOT TESTED, NOT USED, PROBABLY WRONG</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span>
                <span class="nx">val</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;depth&#39;</span> <span class="k">in</span> <span class="nx">val</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">val</span><span class="p">.</span><span class="nx">depth</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="nx">val</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">depth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="nx">val</span><span class="p">.</span><span class="nx">depth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">val</span><span class="p">.</span><span class="nx">depth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
        <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><pre><code> moving recursion out to to the caler...
</code></pre>

<p>if (opts.recurse) {
    groups = _(groups).map(function(g) { 
        if (childProp in g)
            throw new Error(g + ' already has ' + childProp);
        g.depth = g.parent &amp;&amp; g.parent.depth + 1 || 0;
        opts.parent = g;
        if (g.records.length) {
            g[childProp] = e.group(g.records, dim, opts);
        }
        //if (opts.postGroupValHook) g = opts.postGroupValHook(g);
        return g;
    });
}</p></div></div><div class="code"><div class="wrapper">        <span class="nx">groups</span> <span class="o">=</span> <span class="nx">makeGroups</span><span class="p">(</span><span class="nx">groups</span><span class="p">);</span>
        <span class="nx">groups</span><span class="p">.</span><span class="nx">records</span> <span class="o">=</span> <span class="nx">list</span><span class="p">;</span> <span class="c1">// NOT TESTED, NOT USED, PROBABLY WRONG</span>
        <span class="nx">groups</span><span class="p">.</span><span class="nx">dim</span> <span class="o">=</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">dimName</span><span class="p">)</span> <span class="o">?</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">dimName</span> <span class="o">:</span> <span class="nx">dim</span><span class="p">;</span>
        <span class="nx">groups</span><span class="p">.</span><span class="nx">isNumeric</span> <span class="o">=</span> <span class="nx">isNumeric</span><span class="p">;</span>
        <span class="nx">_</span><span class="p">(</span><span class="nx">groups</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">g</span><span class="p">)</span> <span class="p">{</span> 
            <span class="nx">g</span><span class="p">.</span><span class="nx">parentList</span> <span class="o">=</span> <span class="nx">groups</span> 
        <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>pointless without recursion</p></div></div><div class="code"><div class="wrapper">        <span class="c1">//if (opts.postGroupGroupsHook) groups = opts.postGroupGroupsHook(groups);</span>
        <span class="k">return</span> <span class="nx">groups</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nx">Groups</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">asRootVal</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span> <span class="o">||</span> <span class="s1">&#39;Root&#39;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">makeValue</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">records</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">addGroupMethods</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">dim</span> <span class="o">=</span> <span class="s1">&#39;root&#39;</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">Groups</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">rawValues</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">Groups</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">lookup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">query</span><span class="p">))</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if group has children, can search down the tree</p></div></div><div class="code"><div class="wrapper">            <span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="nx">query</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">ret</span><span class="p">;</span>
            <span class="k">while</span><span class="p">(</span><span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">singleLookup</span><span class="p">(</span><span class="nx">values</span><span class="p">.</span><span class="nx">shift</span><span class="p">());</span>
                <span class="nx">list</span> <span class="o">=</span> <span class="nx">ret</span><span class="p">[</span><span class="nx">childProp</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">singleLookup</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">Groups</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">singleLookup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="p">(</span><span class="s1">&#39;lookupMap&#39;</span> <span class="k">in</span> <span class="k">this</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">lookupMap</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">lookupMap</span><span class="p">[</span><span class="nx">d</span><span class="p">]</span> <span class="o">=</span> <span class="nx">d</span><span class="p">;</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">query</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">lookupMap</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">lookupMap</span><span class="p">[</span><span class="nx">query</span><span class="p">];</span>
    <span class="p">};</span>
    <span class="nx">Groups</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">flattenTree</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">chain</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">desc</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">descendants</span><span class="p">();</span>
                        <span class="k">return</span> <span class="p">[</span><span class="nx">d</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">desc</span><span class="p">);</span>
                    <span class="p">})</span>
                    <span class="p">.</span><span class="nx">flatten</span><span class="p">()</span>
                    <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">identity</span><span class="p">)</span> <span class="c1">// expunge nulls</span>
                    <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">addGroupMethods</span><span class="p">)</span>
                    <span class="p">.</span><span class="nx">value</span><span class="p">()</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">flatten</span><span class="p">(</span><span class="nx">_</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">invoke</span><span class="p">(</span><span class="s1">&#39;descendants&#39;</span><span class="p">)));</span>
    <span class="p">};</span>
    
    <span class="kd">function</span> <span class="nx">makeGroups</span><span class="p">(</span><span class="nx">arr_arg</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span> <span class="p">];</span>
        <span class="nx">arr</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">arr_arg</span><span class="p">);</span>
        <span class="c1">//arr.__proto__ = Groups.prototype;</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">method</span> <span class="k">in</span> <span class="nx">Groups</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">value</span><span class="o">:</span> <span class="nx">Groups</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="nx">addUnderscoreMethods</span><span class="p">(</span><span class="nx">arr</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">arr</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">addUnderscoreMethods</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">underscoreMethods</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">methodName</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">(</span><span class="nx">obj</span><span class="p">).</span><span class="nx">has</span><span class="p">(</span><span class="nx">methodName</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
            <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">methodName</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">value</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">part</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">partial</span><span class="p">(</span><span class="nx">_</span><span class="p">[</span><span class="nx">methodName</span><span class="p">],</span> <span class="nx">obj</span><span class="p">)</span>
                    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">part</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">result</span><span class="p">))</span> <span class="nx">e</span><span class="p">.</span><span class="nx">addGroupMethods</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
                    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
                <span class="p">}})</span>
        <span class="p">})</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> memberof enlightenedData </span></p>

<p>{@link http://underscorejs.org/ Underscore} functions that work on arrays get added as methods to Groups.
When an underscore method returns an array, the returned array
also gets extended with these methods</p>

<p><strong>Returns a whatever the underscore function would return</strong></p>

<p>Example:</p>

<p>group.where({foo:bar}).invoke('baz')</p></div></div><div class="code"><div class="wrapper">    <span class="nx">e</span><span class="p">.</span><span class="nx">underscoreMethods</span> <span class="o">=</span> <span class="p">[</span> 
            <span class="s2">&quot;each&quot;</span><span class="p">,</span>
            <span class="s2">&quot;map&quot;</span><span class="p">,</span>
            <span class="s2">&quot;reduce&quot;</span><span class="p">,</span>
            <span class="s2">&quot;find&quot;</span><span class="p">,</span>
            <span class="s2">&quot;filter&quot;</span><span class="p">,</span>
            <span class="s2">&quot;reject&quot;</span><span class="p">,</span>
            <span class="s2">&quot;all&quot;</span><span class="p">,</span>
            <span class="s2">&quot;every&quot;</span><span class="p">,</span>
            <span class="s2">&quot;any&quot;</span><span class="p">,</span>
            <span class="s2">&quot;some&quot;</span><span class="p">,</span>
            <span class="s2">&quot;contains&quot;</span><span class="p">,</span>
            <span class="s2">&quot;invoke&quot;</span><span class="p">,</span>
            <span class="s2">&quot;pluck&quot;</span><span class="p">,</span>
            <span class="s2">&quot;where&quot;</span><span class="p">,</span>
            <span class="s2">&quot;findWhere&quot;</span><span class="p">,</span>
            <span class="s2">&quot;max&quot;</span><span class="p">,</span>
            <span class="s2">&quot;min&quot;</span><span class="p">,</span>
            <span class="s2">&quot;shuffle&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sortBy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;groupBy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;countBy&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sortedIndex&quot;</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span><span class="p">,</span>
            <span class="s2">&quot;first&quot;</span><span class="p">,</span>
            <span class="s2">&quot;initial&quot;</span><span class="p">,</span>
            <span class="s2">&quot;last&quot;</span><span class="p">,</span>
            <span class="s2">&quot;rest&quot;</span><span class="p">,</span>
            <span class="s2">&quot;compact&quot;</span><span class="p">,</span>
            <span class="s2">&quot;flatten&quot;</span><span class="p">,</span>
            <span class="s2">&quot;without&quot;</span><span class="p">,</span>
            <span class="s2">&quot;uniq&quot;</span><span class="p">,</span>
            <span class="s2">&quot;union&quot;</span><span class="p">,</span>
            <span class="s2">&quot;intersection&quot;</span><span class="p">,</span>
            <span class="s2">&quot;difference&quot;</span><span class="p">,</span>
            <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;unzip&quot;</span><span class="p">,</span>
            <span class="c1">//&quot;object&quot;,</span>
            <span class="s2">&quot;indexOf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;lastIndexOf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chain&quot;</span><span class="p">,</span>
            <span class="s2">&quot;result&quot;</span>
            <span class="p">];</span>
    <span class="kd">function</span> <span class="nx">Value</span><span class="p">()</span> <span class="p">{}</span>
    <span class="kd">function</span> <span class="nx">makeValue</span><span class="p">(</span><span class="nx">v_arg</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">v_arg</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">makeStringValue</span><span class="p">(</span><span class="nx">v_arg</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">makeNumberValue</span><span class="p">(</span><span class="nx">v_arg</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">StringValue</span><span class="p">()</span> <span class="p">{}</span>
    <span class="nx">StringValue</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">String</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">makeStringValue</span><span class="p">(</span><span class="nx">s_arg</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">S</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">String</span><span class="p">(</span><span class="nx">s_arg</span><span class="p">);</span>
        <span class="c1">//S.__proto__ = StringValue.prototype;</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">method</span> <span class="k">in</span> <span class="nx">StringValue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">S</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">value</span><span class="o">:</span> <span class="nx">StringValue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">S</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">NumberValue</span><span class="p">()</span> <span class="p">{}</span>
    <span class="nx">NumberValue</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Number</span><span class="p">;</span>
    <span class="kd">function</span> <span class="nx">makeNumberValue</span><span class="p">(</span><span class="nx">n_arg</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">N</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Number</span><span class="p">(</span><span class="nx">n_arg</span><span class="p">);</span>
        <span class="c1">//N.__proto__ = NumberValue.prototype;</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">method</span> <span class="k">in</span> <span class="nx">NumberValue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">N</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">value</span><span class="o">:</span> <span class="nx">NumberValue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">N</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">function</span> <span class="nx">wholeListNumeric</span><span class="p">(</span><span class="nx">groups</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">isNumeric</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">every</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">groups</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span>      <span class="nx">k</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span>
                        <span class="nx">k</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span>
                        <span class="p">(</span><span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nb">Number</span><span class="p">(</span><span class="nx">k</span><span class="p">)))</span> <span class="o">||</span>
                        <span class="p">[</span><span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="s2">&quot;undefined&quot;</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">k</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">())</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
        <span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">isNumeric</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">groups</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">delete</span> <span class="nx">groups</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>        <span class="c1">// getting rid of NULL values in dim list!!</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">isNumeric</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">childProp</span> <span class="o">=</span> <span class="s1">&#39;children&#39;</span><span class="p">;</span>

    <span class="nx">Value</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">extendGroupBy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dim</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">leafNodes</span><span class="p">(),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">opts</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">d</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="k">in</span> <span class="o">&amp;&amp;</span> <span class="nx">d</span><span class="p">.</span><span class="k">in</span> <span class="o">===</span> <span class="s2">&quot;both&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">d</span><span class="p">[</span><span class="nx">childProp</span><span class="p">]</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">diffGroup</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">from</span><span class="p">,</span> <span class="nx">d</span><span class="p">.</span><span class="nx">to</span><span class="p">,</span> <span class="nx">dim</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">d</span><span class="p">[</span><span class="nx">childProp</span><span class="p">]</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">records</span><span class="p">,</span> <span class="nx">dim</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="k">in</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="nx">_</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">childProp</span><span class="p">]).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">c</span><span class="p">.</span><span class="k">in</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="k">in</span><span class="p">;</span>
                        <span class="nx">c</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="k">in</span><span class="p">]</span> <span class="o">=</span> <span class="nx">d</span><span class="p">[</span><span class="nx">d</span><span class="p">.</span><span class="k">in</span><span class="p">];</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nx">d</span><span class="p">[</span><span class="nx">childProp</span><span class="p">].</span><span class="nx">parentVal</span> <span class="o">=</span> <span class="nx">d</span><span class="p">;</span> <span class="c1">// NOT TESTED, NOT USED, PROBABLY WRONG!!!</span>
        <span class="p">});</span>
    <span class="p">};</span>
    <span class="nx">Value</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">leafNodes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="p">[</span><span class="k">this</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">level</span> <span class="o">!==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">[</span><span class="nx">childProp</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="nx">level</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">depth</span> <span class="o">&lt;</span> <span class="nx">level</span><span class="p">))</span>
            <span class="nx">ret</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">flatten</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">childProp</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">leafNodes</span><span class="p">(</span><span class="nx">level</span><span class="p">);</span>
            <span class="p">}),</span> <span class="kc">true</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">makeGroups</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>didn't make this yet, just copied from above
Value.prototype.descendants = function(level) {
    var ret = [this];
    if (level !== 0 &amp;&amp; this[childProp] &amp;&amp; (!level || this.depth &lt; level))
        ret = <em>.flatten(</em>.map(this[childProp], function(c) {
            return c.leafNodes(level);
        }), true);
    return makeGroups(ret);
};</p></div></div><div class="code"><div class="wrapper">    <span class="nx">Value</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">dimPath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">dimPath</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span>
            <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dim</span> <span class="o">===</span> <span class="s1">&#39;Root&#39;</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">dim</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Value</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">namePath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">opts</span> <span class="o">=</span> <span class="nx">opts</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">pedigree</span><span class="p">(</span><span class="nx">opts</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">noRoot</span><span class="p">)</span> <span class="nx">path</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">backwards</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">backwards</span><span class="p">)</span> <span class="nx">path</span><span class="p">.</span><span class="nx">reverse</span><span class="p">();</span> <span class="c1">//kludgy?</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">asArray</span><span class="p">)</span> <span class="k">return</span> <span class="nx">path</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">(</span><span class="nx">opts</span><span class="p">).</span><span class="nx">has</span><span class="p">(</span><span class="s1">&#39;delim&#39;</span><span class="p">))</span> <span class="k">return</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">delim</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>var delim = opts.delim || '/';
return (this.parent ? 
        this.parent.namePath(_.extend({},opts,{notLeaf:true})) : '') +
    ((opts.noRoot &amp;&amp; this.depth===0) ? '' : 
        (this + (opts.notLeaf ? delim : ''))
     )</p></div></div><div class="code"><div class="wrapper">    <span class="p">};</span>
    <span class="nx">Value</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pedigree</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">opts</span> <span class="o">&amp;&amp;</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">notThis</span><span class="p">))</span> <span class="nx">path</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">ptr</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">ptr</span> <span class="o">=</span> <span class="nx">ptr</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">path</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">ptr</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">opts</span> <span class="o">&amp;&amp;</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">asValues</span><span class="p">))</span> <span class="k">return</span> <span class="nx">_</span><span class="p">(</span><span class="nx">path</span><span class="p">).</span><span class="nx">invoke</span><span class="p">(</span><span class="s1">&#39;toString&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">path</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">Value</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">descendants</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">childProp</span><span class="p">]</span> <span class="o">?</span> <span class="k">this</span><span class="p">[</span><span class="nx">childProp</span><span class="p">].</span><span class="nx">flattenTree</span><span class="p">()</span> <span class="o">:</span> <span class="kc">undefined</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="k">this</span><span class="p">[</span><span class="nx">childProp</span><span class="p">],</span>
                <span class="kd">function</span><span class="p">(</span><span class="nx">desc</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">desc</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">val</span><span class="p">.</span><span class="nx">descendants</span><span class="p">())</span>
                <span class="p">},</span>
                <span class="p">[]);</span>
    <span class="p">};</span>
    <span class="nx">Value</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">lookup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">query</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">===</span> <span class="nx">query</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
                <span class="nx">query</span> <span class="o">=</span> <span class="nx">query</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">query</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">query</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">===</span> <span class="nx">query</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;invalid param: &quot;</span> <span class="o">+</span> <span class="nx">query</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">[</span><span class="nx">childProp</span><span class="p">])</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;can only call lookup on Values with kids&quot;</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">[</span><span class="nx">childProp</span><span class="p">].</span><span class="nx">lookup</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="nx">Value</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pct</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">records</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="k">this</span><span class="p">.</span><span class="nx">parentList</span><span class="p">.</span><span class="nx">records</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">};</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> memberof enlightenedData</span></p>

<p>Summarize records by a dimension</p>

<p>Parameters:</p>

<ul>
<li><p><strong>Records must be a list.</strong><br/>(to be summarized)</p></li>
<li><p><strong>Dimension must be a numericDim.</strong><br/>(to summarize by)</p></li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">e</span><span class="p">.</span><span class="nx">aggregate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">numericDim</span><span class="p">)</span> <span class="p">{</span> 
        <span class="k">if</span> <span class="p">(</span><span class="nx">numericDim</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">list</span> <span class="o">=</span> <span class="nx">_</span><span class="p">(</span><span class="nx">list</span><span class="p">).</span><span class="nx">pluck</span><span class="p">(</span><span class="nx">numericDim</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">_</span><span class="p">(</span><span class="nx">list</span><span class="p">).</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">memo</span><span class="p">,</span><span class="nx">num</span><span class="p">){</span>
                    <span class="nx">memo</span><span class="p">.</span><span class="nx">sum</span><span class="o">+=</span><span class="nx">num</span><span class="p">;</span>
                    <span class="nx">memo</span><span class="p">.</span><span class="nx">cnt</span><span class="o">++</span><span class="p">;</span>
                    <span class="nx">memo</span><span class="p">.</span><span class="nx">avg</span><span class="o">=</span><span class="nx">memo</span><span class="p">.</span><span class="nx">sum</span><span class="o">/</span><span class="nx">memo</span><span class="p">.</span><span class="nx">cnt</span><span class="p">;</span> 
                    <span class="nx">memo</span><span class="p">.</span><span class="nx">max</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">memo</span><span class="p">.</span><span class="nx">max</span><span class="p">,</span> <span class="nx">num</span><span class="p">);</span>
                    <span class="k">return</span> <span class="nx">memo</span>
                <span class="p">},{</span><span class="nx">sum</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">cnt</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">max</span><span class="o">:-</span><span class="kc">Infinity</span><span class="p">})</span>
    <span class="p">};</span> </div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> memberof enlightenedData</span></p>

<p>Compare groups across two similar root notes</p>

<p>Parameters:</p>

<pre><code>* **... must be a from.**

* **... must be a to.**

* **... must be a dim.**

* **... must be an opts.**&lt;br/&gt;(used by treelike and some earlier code)
</code></pre></div></div><div class="code"><div class="wrapper">    <span class="nx">e</span><span class="p">.</span><span class="nx">diffGroup</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">dim</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">fromGroup</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span><span class="nx">from</span><span class="p">.</span><span class="nx">records</span><span class="p">,</span> <span class="nx">dim</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">toGroup</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">group</span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">records</span><span class="p">,</span> <span class="nx">dim</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="nx">makeGroups</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="nx">fromGroup</span><span class="p">,</span> <span class="nx">toGroup</span><span class="p">,</span> <span class="nx">dim</span><span class="p">));</span>
        <span class="nx">list</span><span class="p">.</span><span class="nx">dim</span> <span class="o">=</span> <span class="p">(</span><span class="nx">opts</span> <span class="o">&amp;&amp;</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">dimName</span><span class="p">)</span> <span class="o">?</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">dimName</span> <span class="o">:</span> <span class="nx">dim</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">list</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> memberof enlightenedData</span></p>

<p>Compare two groups by a dimension</p>

<p>Parameters:</p>

<pre><code>* **... must be an A.**

* **... must be a B.**

* **... must be a dim.**
</code></pre></div></div><div class="code"><div class="wrapper">    <span class="nx">e</span><span class="p">.</span><span class="nx">compare</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">dim</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">_</span><span class="p">(</span><span class="nx">A</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="o">+</span><span class="s1">&#39;&#39;</span> <span class="p">});</span>
        <span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">_</span><span class="p">(</span><span class="nx">B</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">d</span><span class="o">+</span><span class="s1">&#39;&#39;</span> <span class="p">});</span>
        <span class="kd">var</span> <span class="nx">comp</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="nx">_</span><span class="p">(</span><span class="nx">A</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">comp</span><span class="p">[</span><span class="nx">d</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">name</span><span class="o">:</span> <span class="nx">d</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                <span class="k">in</span><span class="o">:</span> <span class="s1">&#39;from&#39;</span><span class="p">,</span>
                <span class="nx">from</span><span class="o">:</span> <span class="nx">d</span><span class="p">,</span>
                <span class="nx">fromIdx</span><span class="o">:</span> <span class="nx">i</span><span class="p">,</span>
                <span class="nx">dim</span><span class="o">:</span> <span class="nx">dim</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="nx">_</span><span class="p">(</span><span class="nx">B</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">((</span><span class="nx">d</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">in</span> <span class="nx">comp</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">comp</span><span class="p">[</span><span class="nx">d</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">];</span>
                <span class="nx">c</span><span class="p">.</span><span class="k">in</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">;</span>
                <span class="nx">c</span><span class="p">.</span><span class="nx">to</span> <span class="o">=</span> <span class="nx">d</span><span class="p">;</span>
                <span class="nx">c</span><span class="p">.</span><span class="nx">toIdx</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">comp</span><span class="p">[</span><span class="nx">d</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="nx">name</span><span class="o">:</span> <span class="nx">d</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="k">in</span><span class="o">:</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span>
                    <span class="nx">to</span><span class="o">:</span> <span class="nx">d</span><span class="p">,</span>
                    <span class="nx">toIdx</span><span class="o">:</span> <span class="nx">i</span><span class="p">,</span>
                    <span class="nx">dim</span><span class="o">:</span> <span class="nx">dim</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="kd">var</span> <span class="nx">list</span> <span class="o">=</span> <span class="nx">_</span><span class="p">(</span><span class="nx">comp</span><span class="p">).</span><span class="nx">values</span><span class="p">().</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">fromIdx</span> <span class="o">-</span> <span class="nx">b</span><span class="p">.</span><span class="nx">fromIdx</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">toIdx</span> <span class="o">-</span> <span class="nx">b</span><span class="p">.</span><span class="nx">toIdx</span><span class="p">);</span>
        <span class="p">}).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">makeValue</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">val</span><span class="p">,</span> <span class="nx">d</span><span class="p">);</span>
            <span class="nx">val</span><span class="p">.</span><span class="nx">records</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;from&#39;</span> <span class="k">in</span> <span class="nx">d</span><span class="p">)</span>
                <span class="nx">val</span><span class="p">.</span><span class="nx">records</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">records</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">from</span><span class="p">.</span><span class="nx">records</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;to&#39;</span> <span class="k">in</span> <span class="nx">d</span><span class="p">)</span>
                <span class="nx">val</span><span class="p">.</span><span class="nx">records</span> <span class="o">=</span> <span class="nx">val</span><span class="p">.</span><span class="nx">records</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">to</span><span class="p">.</span><span class="nx">records</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="nx">_</span><span class="p">(</span><span class="nx">list</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">d</span><span class="p">.</span><span class="nx">parentList</span> <span class="o">=</span> <span class="nx">list</span><span class="p">;</span> <span class="c1">// NOT TESTED, NOT USED, PROBABLY WRONG</span>
            <span class="nx">d</span><span class="p">.</span><span class="nx">records</span><span class="p">.</span><span class="nx">parentVal</span> <span class="o">=</span> <span class="nx">d</span><span class="p">;</span> <span class="c1">// NOT TESTED, NOT USED, PROBABLY WRONG</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nx">list</span><span class="p">;</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> memberof enlightenedData</span></p>

<p>Concatenate two Values into a new one (??)</p>

<p>Parameters:</p>

<pre><code>* **... must be a from.**

* **... must be a to.**
</code></pre></div></div><div class="code"><div class="wrapper">    <span class="nx">e</span><span class="p">.</span><span class="nx">compareValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">from</span><span class="p">.</span><span class="nx">dim</span> <span class="o">!==</span> <span class="nx">to</span><span class="p">.</span><span class="nx">dim</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;not sure what you&#39;re trying to do&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">from</span> <span class="o">+</span> <span class="s1">&#39; to &#39;</span> <span class="o">+</span> <span class="nx">to</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">val</span> <span class="o">=</span> <span class="nx">makeValue</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">from</span> <span class="o">=</span> <span class="nx">from</span><span class="p">;</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">to</span> <span class="o">=</span> <span class="nx">to</span><span class="p">;</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">depth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">val</span><span class="p">.</span><span class="k">in</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span><span class="p">;</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">records</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">from</span><span class="p">.</span><span class="nx">records</span><span class="p">,</span><span class="nx">to</span><span class="p">.</span><span class="nx">records</span><span class="p">);</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">records</span><span class="p">.</span><span class="nx">parentVal</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span> <span class="c1">// NOT TESTED, NOT USED, PROBABLY WRONG</span>
        <span class="nx">val</span><span class="p">.</span><span class="nx">dim</span> <span class="o">=</span> <span class="nx">from</span><span class="p">.</span><span class="nx">dim</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">val</span><span class="p">;</span>
    <span class="p">};</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">StringValue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Value</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span>
    <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">NumberValue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="nx">Value</span><span class="p">.</span><span class="nx">prototype</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> memberof enlightenedData</span></p>

<p>Sometimes a Group gets turned into a standard array,
 e.g., through slicing or sorting or filtering. 
 addGroupMethods turns it back into a Group</p>

<p>Parameters:</p>

<ul>
<li><strong>Array must be an Array.</strong><br/>(to be extended)</li>
</ul></div></div><div class="code"><div class="wrapper">    <span class="nx">e</span><span class="p">.</span><span class="nx">addGroupMethods</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">method</span> <span class="k">in</span> <span class="nx">Groups</span><span class="p">.</span><span class="nx">prototype</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">method</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">value</span><span class="o">:</span> <span class="nx">Groups</span><span class="p">.</span><span class="nx">prototype</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span>
            <span class="p">});</span>
        <span class="p">}</span>
        <span class="nx">addUnderscoreMethods</span><span class="p">(</span><span class="nx">arr</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">arr</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">e</span><span class="p">;</span>
<span class="p">}());</span></div></div></div></div></body></html>